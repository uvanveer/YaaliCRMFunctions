void automation.Cancel_Amazon_Dropshiop_Order(Int recordId)
{
/* Ezhilarasu 05/05/2020 */
start_time = now.toLong();
/* To Send amazon order cancelled mail to orders team */
Get_Order = zoho.crm.getRecordById("Sales_Orders",recordId);
GetOrderId = Get_Order.get("Subject");
Get_source = Get_Order.get("Source");
Get_Order_status = Get_Order.get("Status");
if(Get_source.contains("Amazon") == true && Get_Order_status == "Canceled")
{
	sendmail
	[
		from :zoho.loginuserid
		to :"orders@bestaccessdoors.com"
		subject :"Amazon Order was cancelled"
		message :"<div>Hi Team,<br><br>We have found that the following Amazon order " + GetOrderId + " is cancelled'.</div>"
	]
	info "Inside send mail";
}
searchdropship = zoho.crm.searchRecords("Purchase_Orders","Sales_Order:equals:" + recordId);
info searchdropship;
Shipped_count = 0;
if(searchdropship.size() > 0)
{
	for each  dropship_order in searchdropship.tolist()
	{
		Get_status = dropship_order.get("Status");
		info Get_status;
		if(Get_status == "Shipped")
		{
			Shipped_count = 1;
		}
	}
}
info "Shipped_count:" + Shipped_count;
info "Get_status:" + Get_status;
info "Get_SOurce:" + Get_source.contains("Amazon");
if(Shipped_count == 0 && Get_Order_status == "Canceled" && Get_source.contains("Amazon") == true)
{
	for each  dropship_order in searchdropship.tolist()
	{
		Update_PO_Map = Map();
		Update_PO_Map.put("Status","Cancelled");
		Get_Po_Id = dropship_order.get("id");
		Update_Po = zoho.crm.updateRecord("Purchase_Orders",Get_Po_Id,Update_PO_Map);
		info Update_Po;
	}
}
else if(Shipped_count == 0 && Get_Order_status == "Cancelled" && Get_source.contains("Amazon") == false)
{
	for each  dropship_order in searchdropship.tolist()
	{
		Update_PO_Map = Map();
		Update_PO_Map.put("Status","Cancelled");
		Get_Po_Id = dropship_order.get("id");
		Update_Po = zoho.crm.updateRecord("Purchase_Orders",Get_Po_Id,Update_PO_Map);
		info "test" + Update_Po;
	}
}
/*else if(Shipped_count == 1 && Get_Order_status == "Cancelled" && Get_source.contains("Amazon") == false)
{
	for each  dropship_order in searchdropship.tolist()
	{
		Update_PO_Map = Map();
		Update_PO_Map.put("Status","Cancelled");
		Get_Po_Id = dropship_order.get("id");
		Update_Po = zoho.crm.updateRecord("Purchase_Orders",Get_Po_Id,Update_PO_Map);
		info "test" + Update_Po;
	}
}*/
// //additional logging - rpr
// Get_Owner = getAmazonOrderReturns.get("Owner").get("name");
// Get_subject = getAmazonOrderReturns.get("Subject");
// Sales_Order_Number = Get_subject;
// Get_contact = getAmazonOrderReturns.get("Contact_Name").get("name");
// Get_salesOrder_ID = getAmazonOrderReturns.get("id");
// Get_store = getAmazonOrderReturns.get("Store").get("name");
// logMap = Map();
// logMap.put("Name","Sales Orders");
// logMap.put("Sales_Order_Number",Sales_Order_Number);
// logMap.put("SalesOrder_Record_ID",Get_salesOrder_ID.toString());
// logMap.put("SalesOrder_Request",getAmazonOrderReturns);
// logMap.put("SO_Workflow_Name","Cancel_Dropship_Order");
// logMap.put("Created_Edited_By",Get_Owner);
// logMap.put("SalesOrder_Contact",Get_contact);
// logMap.put("SalesOrder_Store",Get_store);
// end_time = now.toLong();
// logMap.put("Start_Time",start_time.toString());
// logMap.put("End_Time",end_time.toString());
// Create_log = zoho.crm.createRecord("Sales_Order_PO_Log",logMap);
// info Create_log;
/* Update Dropship Orders Status Cancelled */
// If amazon sales order status changes to canceled - change respective dropsip order status to cancelled.
/*
dropshipOrder = zoho.crm.getRelatedRecords("Dropship_Orders","Sales_Orders",recordId);
for each  dropshipdata in dropshipOrder
{
	dropshipOrderId = dropshipdata.get("id");
	updateStatus = Map();
	updateStatus.put("Status","Cancelled");
	updatesalesorder = zoho.crm.updateRecord("Purchase_Orders",dropshipOrderId,updateStatus);
}
*/
}